(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[250],{8413:()=>{},9250:(e,t,r)=>{"use strict";r.r(t),r.d(t,{ServiceMap:()=>D});var n=r(5155),a=r(2115);let o=(0,a.createContext)(null);function s(){let e=(0,a.use)(o);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var l=r(5752),i=r.n(l);let c=(0,a.forwardRef)(function({bounds:e,boundsOptions:t,center:r,children:n,className:s,id:i,placeholder:c,style:u,whenReady:d,zoom:p,...f},h){let[m]=(0,a.useState)({className:s,id:i,style:u}),[x,g]=(0,a.useState)(null),v=(0,a.useRef)(void 0);(0,a.useImperativeHandle)(h,()=>x?.map??null,[x]);let b=(0,a.useCallback)(n=>{if(null!==n&&!v.current){let a=new l.Map(n,f);v.current=a,null!=r&&null!=p?a.setView(r,p):null!=e&&a.fitBounds(e,t),null!=d&&a.whenReady(d),g(Object.freeze({__version:1,map:a}))}},[]);(0,a.useEffect)(()=>()=>{x?.map.remove()},[x]);let y=x?a.createElement(o,{value:x},n):c??null;return a.createElement("div",{...m,ref:b},y)});var u=r(7650);function d(e,t){let r=(0,a.useRef)(t);(0,a.useEffect)(function(){t!==r.current&&null!=e.attributionControl&&(null!=r.current&&e.attributionControl.removeAttribution(r.current),null!=t&&e.attributionControl.addAttribution(t)),r.current=t},[e,t])}function p(e,t){let r=(0,a.useRef)(void 0);(0,a.useEffect)(function(){return null!=t&&e.instance.on(t),r.current=t,function(){null!=r.current&&e.instance.off(r.current),r.current=null}},[e,t])}function f(e,t){let r=e.pane??t.pane;return r?{...e,pane:r}:e}function h(e,t,r){return Object.freeze({instance:e,context:t,container:r})}function m(e,t){return null==t?function(t,r){let n=(0,a.useRef)(void 0);return n.current||(n.current=e(t,r)),n}:function(r,n){let o=(0,a.useRef)(void 0);o.current||(o.current=e(r,n));let s=(0,a.useRef)(r),{instance:l}=o.current;return(0,a.useEffect)(function(){s.current!==r&&(t(l,r,s.current),s.current=r)},[l,r,t]),o}}function x(e){return function(t){var r;let n=s(),o=e(f(t,n),n);return d(n.map,t.attribution),p(o.current,t.eventHandlers),r=o.current,(0,a.useEffect)(function(){return(n.layerContainer??n.map).addLayer(r.instance),function(){n.layerContainer?.removeLayer(r.instance),n.map.removeLayer(r.instance)}},[n,r]),o}}let g=function(e,t){var r;return r=x(m(e,t)),(0,a.forwardRef)(function(e,t){let{instance:n}=r(e).current;return(0,a.useImperativeHandle)(t,()=>n),null})}(function({url:e,...t},r){return h(new l.TileLayer(e,f(t,r)),r)},function(e,t,r){let{opacity:n,zIndex:a}=t;null!=n&&n!==r.opacity&&e.setOpacity(n),null!=a&&a!==r.zIndex&&e.setZIndex(a);let{url:o}=t;null!=o&&o!==r.url&&e.setUrl(o)}),v=function(e,t){var r;return r=x(m(e,t)),(0,a.forwardRef)(function(e,t){let{instance:n,context:s}=r(e).current;(0,a.useImperativeHandle)(t,()=>n);let{children:l}=e;return null==l?null:a.createElement(o,{value:s},l)})}(function({position:e,...t},r){var n;let a=new l.Marker(e,t);return h(a,(n={overlayContainer:a},Object.freeze({...r,...n})))},function(e,t,r){t.position!==r.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==r.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==r.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==r.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==r.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}),b=function(e,t){var r,n;return r=m(e),n=function(e,n){let a=s(),o=r(f(e,a),a);return d(a.map,e.attribution),p(o.current,e.eventHandlers),t(o.current,a,e,n),o},(0,a.forwardRef)(function(e,t){let[r,o]=(0,a.useState)(!1),{instance:s}=n(e,o).current;(0,a.useImperativeHandle)(t,()=>s),(0,a.useEffect)(function(){r&&s.update()},[s,r,e.children]);let l=s._contentNode;return l?(0,u.createPortal)(e.children,l):null})}(function(e,t){return h(new l.Popup(e,t.overlayContainer),t)},function(e,t,{position:r},n){(0,a.useEffect)(function(){let{instance:a}=e;function o(e){e.popup===a&&(a.update(),n(!0))}function s(e){e.popup===a&&n(!1)}return t.map.on({popupopen:o,popupclose:s}),null==t.overlayContainer?(null!=r&&a.setLatLng(r),a.openOn(t.map)):t.overlayContainer.bindPopup(a),function(){t.map.off({popupopen:o,popupclose:s}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(a)}},[e,t,n,r])});class y{async findNearbyServices(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{radius:n=50,maxResults:a=20,serviceType:o="truck_repair"}=r,s=this.getSearchQueries(o),l=this.calculateBoundingBox(e,t,n),i=[];for(let r of s)try{let n=await fetch("".concat(this.baseUrl,"/search?")+"q=".concat(encodeURIComponent(r),"&")+"format=json&bounded=1&"+"viewbox=".concat(l.join(","),"&")+"limit=".concat(Math.ceil(a/s.length),"&")+"addressdetails=1&extratags=1",{headers:{"User-Agent":this.userAgent}});if(!n.ok){console.warn("Nominatim request failed for query: ".concat(r));continue}let o=await n.json(),c=this.processResults(o,e,t);i.push(...c),await this.delay(1e3)}catch(e){console.error("Error searching for ".concat(r,":"),e)}return this.removeDuplicates(i).sort((e,t)=>(e.distance||0)-(t.distance||0)).slice(0,a)}async geocodeAddress(e){try{let t=await fetch("".concat(this.baseUrl,"/search?")+"q=".concat(encodeURIComponent(e),"&")+"format=json&limit=1",{headers:{"User-Agent":this.userAgent}});if(!t.ok)throw Error("Geocoding failed: ".concat(t.status));let r=await t.json();if(r.length>0)return{lat:parseFloat(r[0].lat),lng:parseFloat(r[0].lon)};return null}catch(e){return console.error("Geocoding error:",e),null}}getSearchQueries(e){let t={truck_repair:["truck repair service","diesel mechanic","commercial vehicle repair"],truck_stop:["truck stop","travel center"],parts_store:["truck parts store","heavy duty parts"],towing:["heavy duty towing","truck towing service"]};return t[e]||t.truck_repair}calculateBoundingBox(e,t,r){let n=r/69;return[t-n,e-n,t+n,e+n]}processResults(e,t,r){return e.map(e=>{var n,a,o;let s=parseFloat(e.lat),l=parseFloat(e.lon),i=this.calculateDistance(t,r,s,l);return{name:e.display_name.split(",")[0]||"Unknown Service",address:this.formatAddress(e),coordinates:[s,l],distance:i,phone:null==(n=e.extratags)?void 0:n.phone,website:null==(a=e.extratags)?void 0:a.website,openingHours:null==(o=e.extratags)?void 0:o.opening_hours,services:this.extractServices(e)}})}formatAddress(e){let t=e.address||{};return[t.house_number,t.road,t.city||t.town,t.state,t.postcode].filter(Boolean).join(", ")}extractServices(e){let t=[],r=e.extratags||{};return"fuel"===r.amenity&&t.push("Fuel"),"vehicle:repair"===r.service&&t.push("Repair"),"car_parts"===r.shop&&t.push("Parts"),"restaurant"===r.amenity&&t.push("Food"),t}removeDuplicates(e){let t=new Set;return e.filter(e=>{let r="".concat(e.name,"-").concat(e.address);return!t.has(r)&&(t.add(r),!0)})}calculateDistance(e,t,r,n){let a=this.toRadians(r-e),o=this.toRadians(n-t),s=Math.sin(a/2)*Math.sin(a/2)+Math.cos(this.toRadians(e))*Math.cos(this.toRadians(r))*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*3959}toRadians(e){return Math.PI/180*e}delay(e){return new Promise(t=>setTimeout(t,e))}constructor(){this.baseUrl="https://nominatim.openstreetmap.org",this.userAgent="TruckRepairAssistant/1.0"}}new y,r(8413),delete i().Icon.Default.prototype._getIconUrl,i().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});let w=e=>new(i()).Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-".concat(e,".png"),shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),j={truck_repair:w("red"),truck_stop:w("blue"),parts_store:w("green"),towing:w("orange"),default:w("grey")};function k(e){let{center:t,zoom:r}=e,n=s().map;return(0,a.useEffect)(()=>{n.setView(t,r)},[n,t,r]),null}function D(e){let{userLocation:t,selectedServiceType:r="truck_repair",onServiceSelect:o,onServiceTypeChange:s,searchRadius:l=50,className:i="h-96 w-full rounded-lg"}=e,[u,d]=(0,a.useState)([]),[p,f]=(0,a.useState)(!1),[h,m]=(0,a.useState)(null),[x,w]=(0,a.useState)([39.8283,-98.5795]),[D,C]=(0,a.useState)(4),N=(0,a.useMemo)(()=>new y,[]);(0,a.useEffect)(()=>{t?(w([t.lat,t.lng]),C(12)):navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{w([e.coords.latitude,e.coords.longitude]),C(12)},e=>{console.error("Error getting user location:",e)})},[t]),(0,a.useEffect)(()=>{(async()=>{let e=t||(39.8283!==x[0]?{lat:x[0],lng:x[1]}:null);if(e){f(!0),m(null);try{let t=(await N.findNearbyServices(e.lat,e.lng,{serviceType:r,radius:"string"==typeof l?parseInt(l):l,maxResults:20})).map(e=>({...e,lat:e.coordinates[0],lon:e.coordinates[1],serviceType:r}));d(t)}catch(e){m(e instanceof Error?e.message:"Failed to find services"),d([])}finally{f(!1)}}})()},[t,r,l,x,N]);let S=e=>j[e.serviceType||"default"]||j.default,_=e=>{null==o||o(e)},R=e=>{let r=t||{lat:x[0],lng:x[1]};return"https://www.google.com/maps/dir/".concat(r.lat,",").concat(r.lng,"/").concat(e.lat,",").concat(e.lon)};return(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("div",{className:"absolute top-4 left-4 z-[1000] bg-gradient-to-br from-white via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-blue-950 dark:to-blue-900 rounded-xl shadow-2xl backdrop-blur-md p-4 space-y-3 border border-blue-200 dark:border-blue-800 animate-fade-in",children:[(0,n.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Service Type:"}),(0,n.jsxs)("select",{value:r,onChange:e=>null==s?void 0:s(e.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1",children:[(0,n.jsx)("option",{value:"truck_repair",children:"\uD83D\uDD27 Repair Shops"}),(0,n.jsx)("option",{value:"truck_stop",children:"⛽ Truck Stops"}),(0,n.jsx)("option",{value:"parts_store",children:"\uD83D\uDECD️ Parts Stores"}),(0,n.jsx)("option",{value:"towing",children:"\uD83D\uDE9B Towing Services"})]}),p&&(0,n.jsxs)("div",{className:"text-xs text-blue-600 flex items-center",children:[(0,n.jsxs)("svg",{className:"animate-spin h-3 w-3 mr-1",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Searching..."]}),h&&(0,n.jsxs)("div",{className:"text-xs text-red-600",children:["Error: ",h]}),(0,n.jsxs)("div",{className:"text-xs text-gray-600",children:["Found: ",u.length," services"]})]}),(0,n.jsxs)(c,{center:x,zoom:D,className:i+" shadow-2xl border-2 border-blue-200 dark:border-blue-800 rounded-2xl transition-all duration-500",style:{height:"100%",width:"100%"},children:[(0,n.jsx)(k,{center:x,zoom:D}),(0,n.jsx)(g,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),t&&(0,n.jsx)(v,{position:[t.lat,t.lng],children:(0,n.jsx)(b,{children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"font-semibold text-blue-600",children:"\uD83D\uDCCD Your Location"}),(0,n.jsxs)("div",{className:"text-sm text-gray-600",children:[t.lat.toFixed(4),", ",t.lng.toFixed(4)]})]})})}),u.map((e,t)=>(0,n.jsx)(v,{position:[e.lat,e.lon],icon:S(e),eventHandlers:{click:()=>_(e)},children:(0,n.jsx)(b,{children:(0,n.jsxs)("div",{className:"min-w-[200px] max-w-[300px]",children:[(0,n.jsx)("div",{className:"font-semibold text-gray-800 mb-2",children:e.name||e.display_name}),e.address&&(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["\uD83D\uDCCD ",e.address]}),e.distance&&(0,n.jsxs)("div",{className:"text-sm text-blue-600 mb-2",children:["\uD83D\uDCCF ",e.distance.toFixed(1)," miles away"]}),e.phone&&(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["\uD83D\uDCDE ",(0,n.jsx)("a",{href:"tel:".concat(e.phone),className:"text-blue-600 hover:underline",children:e.phone})]}),e.website&&(0,n.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:["\uD83C\uDF10 ",(0,n.jsx)("a",{href:e.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Website"})]}),(0,n.jsxs)("div",{className:"flex space-x-2 mt-3",children:[(0,n.jsx)("button",{onClick:()=>_(e),className:"px-3 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 transition-colors",children:"Select"}),(0,n.jsx)("a",{href:R(e),target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600 transition-colors",children:"Directions"}),e.phone&&(0,n.jsx)("a",{href:"tel:".concat(e.phone),className:"px-3 py-1 bg-gray-500 text-white text-xs rounded hover:bg-gray-600 transition-colors",children:"Call"})]})]})})},t))]})]})}}}]);