"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[870],{5870:(e,r,s)=>{s.r(r),s.d(r,{AudioRecorder:()=>o});var l=s(5155),n=s(2115),t=s(138),a=s.n(t);function o(e){let{onRecordingComplete:r,onAnalysisResult:s,maxDuration:t=30,className:o=""}=e,[d,i]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(0),[x,g]=(0,n.useState)(null),[b,p]=(0,n.useState)(!1),[f,v]=(0,n.useState)(null),[j,y]=(0,n.useState)(null),w=(0,n.useRef)(null),N=(0,n.useRef)(null),R=(0,n.useRef)(null),C=(0,n.useRef)(null);(0,n.useEffect)(()=>{(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});y(!0),e.getTracks().forEach(e=>e.stop())}catch(e){y(!1),v("Microphone permission denied. Please enable microphone access to record engine sounds.")}})()},[]),(0,n.useEffect)(()=>()=>{R.current&&clearInterval(R.current),N.current&&N.current.getTracks().forEach(e=>e.stop()),C.current&&C.current.close()},[]);let M=async()=>{try{v(null);let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,sampleRate:44100}});N.current=e;let r=new(a())(e,{type:"audio",mimeType:"audio/wav",recorderType:a().StereoAudioRecorder,numberOfAudioChannels:1,desiredSampRate:44100});r.startRecording(),w.current=r,i(!0),m(0),R.current=setInterval(()=>{m(e=>{let r=e+1;return r>=t&&k(),r})},1e3)}catch(e){v("Failed to start recording. Please check microphone permissions."),console.error("Recording error:",e)}},k=()=>{w.current&&d&&w.current.stopRecording(()=>{let e=w.current.getBlob(),s=URL.createObjectURL(e);g(s),i(!1),R.current&&(clearInterval(R.current),R.current=null),N.current&&(N.current.getTracks().forEach(e=>e.stop()),N.current=null),null==r||r(e,s),z(e)})},z=async e=>{p(!0);try{let r=new(window.AudioContext||window.webkitAudioContext);C.current=r;let l=await e.arrayBuffer(),n=await r.decodeAudioData(l),t=n.getChannelData(0),a=A(t,n.sampleRate);null==s||s(a)}catch(e){console.error("Audio analysis error:",e),v("Failed to analyze audio recording.")}finally{p(!1)}},A=(e,r)=>{let s=e.length/r,l=Math.min(Math.max(100*Math.sqrt(e.reduce((e,r)=>e+r*r,0)/e.length),0),100),n=0,t=0;l>20&&(t=.7*(n=2e3*Math.random()+100));let a=[],o=[];return l<10?(a.push("Recording volume is low. Try recording closer to the engine."),a.push("Ensure engine is running during recording.")):l>80&&a.push("Recording may be too loud. Try recording from a bit further away."),n<200?o.push("Low frequency noise detected - possible engine mount issues"):n>1500?o.push("High frequency noise detected - possible bearing or timing issues"):o.push("Normal engine frequency range detected"),s<5&&a.push("Record for at least 10-15 seconds for better analysis."),{duration:s,averageFrequency:t,peakFrequency:n,noiseLevel:l,suggestions:a,possibleIssues:o}},S=e=>{let r=Math.floor(e/60);return"".concat(r,":").concat((e%60).toString().padStart(2,"0"))};return!1===j?(0,l.jsx)("div",{className:"bg-red-50 border-2 border-red-400 rounded-lg p-6 ".concat(o),children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("svg",{className:"h-5 w-5 text-red-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)("h3",{className:"text-sm font-bold text-red-900",children:"Microphone Access Required"}),(0,l.jsx)("p",{className:"text-sm font-medium text-red-800 mt-1",children:"Please enable microphone access to record engine sounds for analysis."})]})]})}):(0,l.jsxs)("div",{className:"bg-white border-2 border-gray-200 rounded-lg shadow-lg p-6 ".concat(o),children:[(0,l.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center",children:"\uD83C\uDFA4 Engine Sound Analysis"}),f&&(0,l.jsx)("div",{className:"mb-4 bg-red-50 border-2 border-red-400 rounded-lg p-4",children:(0,l.jsx)("p",{className:"text-red-900 text-sm font-medium",children:f})}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[!d&&!x&&(0,l.jsxs)("button",{onClick:M,disabled:!0!==j,className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-semibold border-2 border-red-600 hover:border-red-700",children:[(0,l.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})}),"Start Recording"]}),d&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",{onClick:k,className:"flex items-center px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors font-semibold border-2 border-gray-700 hover:border-gray-800",children:[(0,l.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z",clipRule:"evenodd"})}),"Stop"]}),(0,l.jsx)("button",{onClick:()=>{w.current&&d&&(c?(w.current.resumeRecording(),u(!1)):(w.current.pauseRecording(),u(!0)))},className:"flex items-center px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-semibold border-2 border-yellow-600 hover:border-yellow-700",children:c?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})}),"Resume"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Pause"]})})]}),x&&(0,l.jsxs)("button",{onClick:()=>{x&&URL.revokeObjectURL(x),g(null),m(0),v(null)},className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold border-2 border-red-600 hover:border-red-700",children:[(0,l.jsxs)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,l.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z",clipRule:"evenodd"}),(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414L7.586 12l-1.293 1.293a1 1 0 101.414 1.414L9 13.414l2.293 2.293a1 1 0 001.414-1.414L11.414 12l1.293-1.293z",clipRule:"evenodd"})]}),"Discard"]})]}),(d||h>0)&&(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[d&&(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-3 h-3 bg-red-600 rounded-full animate-pulse mr-2"}),(0,l.jsx)("span",{className:"text-red-800 font-bold",children:"REC"})]}),(0,l.jsxs)("span",{className:"text-lg font-mono font-bold text-gray-900",children:[S(h)," / ",S(t)]}),c&&(0,l.jsx)("span",{className:"text-yellow-800 text-sm font-bold",children:"(Paused)"})]}),x&&(0,l.jsxs)("div",{className:"bg-gray-50 border-2 border-gray-300 rounded-lg p-4",children:[(0,l.jsx)("h4",{className:"text-sm font-bold text-gray-900 mb-2",children:"Recorded Audio:"}),(0,l.jsx)("audio",{controls:!0,src:x,className:"w-full"})]}),b&&(0,l.jsx)("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsxs)("svg",{className:"animate-spin h-5 w-5 text-blue-700 mr-3",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,l.jsx)("span",{className:"text-blue-900 font-bold",children:"Analyzing audio..."})]})}),!d&&!x&&(0,l.jsxs)("div",{className:"bg-blue-50 border-2 border-blue-300 rounded-lg p-4",children:[(0,l.jsx)("h4",{className:"text-sm font-bold text-blue-900 mb-2",children:"\uD83D\uDCCB Recording Tips:"}),(0,l.jsxs)("ul",{className:"text-sm font-medium text-blue-800 space-y-1",children:[(0,l.jsx)("li",{children:"• Make sure the engine is running"}),(0,l.jsx)("li",{children:"• Record for at least 10-15 seconds"}),(0,l.jsx)("li",{children:"• Hold the device close to the engine (but safely)"}),(0,l.jsx)("li",{children:"• Try to minimize background noise"}),(0,l.jsx)("li",{children:"• Record both idle and rev-up sounds if possible"})]})]})]})]})}}}]);